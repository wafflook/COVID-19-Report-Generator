<!doctype html>
 <html>
  <head>

    <title>無題</title>

    <meta charset='utf-8'>
    <meta content='Yusuke Sano' name='author'>
    <meta content='新型コロナウイルス感染症の文書をＰＣから入力' name='description'>
    <meta content='telephone=no,address=no,email=no,date=no,url=no' name='format-detection'>
    <meta content='noimageindex,notranslate,nosnippet,noarchive,nofollow,noindex' name='robots'>
    <meta content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no' name='viewport'>

    <link href='js/jquery/Fomantic-UI/2.8.8-custom.css' rel='stylesheet'>
    <link href='asset/manifest.json' rel='manifest'>
    <link href='asset/favicon.ico' rel='icon'>

    <style>
      html,
      body{
        -webkit-text-stroke:.3px;
        font:12px 'M+2VM+IPAG circle Regular';
      }
      html,
      body,
      main,
      main .ui.grid,
      main .ui.grid > .row,
      main .ui.grid > .row > .column{
        height:100vh;
      }
      body{
        background-color:#fafafa;
      }
      main{
        float:right;
        width:fit-content;
      }
   </style>
    <style>
      .ui.grid.celled > .row > .column:nth-child(3){
        padding:0;
      }
   </style>
    <style>
      .ui.grid > .row > .column{
        height:100vh;
        overflow-y:scroll;
      }
      .ui.grid > .row > .column::-webkit-scrollbar{
        display:none;
      }
      .ui.grid > .row > .column:nth-child(1),      .ui.grid > .row > .column:nth-child(2){
        width:428px;
        padding-left:5em !important;
      }
      .ui.grid > .row > .column:nth-child(3){
        width:210mm;
      }
      .ui.grid > .row > .column:nth-child(3) > .ui.segments > .ui.segment,
      .ui.grid > .row > .column:nth-child(3) > .ui.segments{
        height:100%;
      }
   </style>
    <style>
      iframe{
        width:100%;
        height:100%;
        border:none;
        outline:none;
        display:block;
      }
   </style>
    <style>

   </style>
    <style>
      /*
       * FontAwesome v6.0.0
       */
       i.icon.i:before {
         content:"\49";
       }
       i.icon.t:before{
         content:"\54";
       }
       i.icon.earser:before{
         content:"\f12d";
       }
    </style>
     <style>
       .item .property-name{
         display:none;
       }
       .item .c{
         flex:1;
       }
    </style>
     <style>
      .dg .cr.focus{
        background:beige;
      }
      .column > .ui.segments{
        border-bottom: 2px solid rgba(34,36,38,.15) !important;
        box-shadow: rgb(16 36 94 / 40%) 0 2px 6px 0 !important;
      }
   </style>
    <style>
       @media only screen and (max-width: 820px) {
         .ui.grid.celled{
           width:100vw;
           overflow:hidden;
         }
         .ui.grid.celled > .row{
           display:flex;
           overflow-x:auto;
           flex-wrap:nowrap;
           scroll-snap-type:x mandatory;
         }
         .ui.grid.celled > .row > .column{
           width:100vw !important;
           min-width:100vw !important;
           scroll-snap-align: start;
           height:100% !important;
         }
       }
   </style>
    <style>
      input::selection{
        background-color:#0cf;
      }
   </style>
    <style>
      .ui.selection.list > .item
      .ui.selection.list .list > .item{
        color:rgba(0, 0, 0, 1.0) !important;
      }
      .ui.selection.list{
        background-color:beige;
      }
   </style>
    <style>
      .ui.selection.dropdown{
        border:none;
        height:auto;
        min-height:auto;
        padding:0.28571429em 3.2em 0.28571429em 1em;
      }
      .ui.search.dropdown > .text{
        width:100%;
        overflow: hidden;
        white-space: nowrap;
        text-overflow:ellipsis;
      }

      .ui.search.dropdown > .text,
      .ui.menu .ui.dropdown .menu > .item{

        white-space:nowrap;
        word-break:keep-all;

      }
      .ui.menu .ui.dropdown .menu > .item{
        padding:0.26190476rem 1.14285714rem !important;
      }
      .ui.search.selection.dropdown > input.search{
        padding:0.26190476rem 1.14285714rem;
      }

      .ui.selection.dropdown > .dropdown.icon{
        padding:0.41666667em
      }
      .ui.selection.dropdown .menu > .item{
        min-height:1.285714285rem;
      }
   </style>
    <style>
      .column > .ui.segments:nth-child(1){
        z-index:999;
      }
   </style>
 </head>
  <body>
    <main v-enter-to-next-input>
      <div class='ui grid internally celled'>
        <div class='row'>
          <div class='column'>
            <div class='ui segments block animate__animated animate__bounce'>
              <div class='ui segment block'>
                <div class='content fitted'>
                  <div class='ui card fluid basic'>
                    <div class='content'>
                      <img class='ui image floated left mini' src='asset/me.jpg'>
                      <div class='header'>
                        Repola
                     </div>
                      <div class='meta'>
                        Yusuke Sano
                     </div>
                      <div class='description'>
                        <p>発生届をＰＣから入力可能にしました。問題があれば連絡下さい</p>
                     </div>
                   </div>
                 </div>
               </div>
                <a class='ui label corner' href='https://twitter.com/wafflook' target='_blank'>
                  <i class='icon twitter'></i>
               </a>
             </div>
              <div class='ui segment block teal'>
                <div class="ui label floating point right pointing teal">
                  設定
               </div>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value v-model='pdfLib.settings.debounce' label='入力をＰＤＦに反映' :values="{'０.５秒間入力がなければ反映':500,'１.０秒間入力がなければ反映':1000,'１.５秒間入力がなければ反映':1500}"></dat-value>
                    <dat-folder name='カラー'>
                      <dat-color v-model='pdfLib.settings.color.text' label='文字色'></dat-color>
                      <dat-color v-model='pdfLib.settings.color.mark' label='塗潰色'></dat-color>
                   </dat-folder>
                    <dat-folder name='フォント'>
                      <dat-value v-model='pdfLib.settings.fontname' label='ファミリ' :values='_.keys(fonts)'></dat-value>   
                   </dat-folder>
                 </dat-gui>
               </div>
             </div>
           </div>
            <div class='ui segments block'>
              <div class='ui segment block'>
                <div class='content'>
                  <p>...</p>
               </div>
             </div>
              <div class='ui segment block'>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value v-model='共通.医師の従事病院または診療所の名称' label='病院は？'></dat-value>
                 </dat-gui>
               </div>
             </div>
              <div class='ui segment block blue'>
                <div class='ui label floating point right pointing blue'>
                  病院
               </div>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value v-model='共通.医師の従事病院または診療所の所在地' label='病院の住所は？'></dat-value>
                    <dat-value v-model='共通.医師の従事病院または診療所の電話番号'label='病院の連絡先は？' type='phone'></dat-value>
                    <dat-value v-model='共通.医師の従事病院または診療所の時間外の電話番号' label='診療時間外の連絡先は？' comment='診療時間外の連絡先' type='phone'></dat-value>
                 </dat-gui>
               </div>
             </div>
           </div>
            <div class='ui segments block'>
              <div class='ui segment block'>
                <div class='content'>
                  <p>...</p>
               </div>
             </div>
              <div class='ui segment block'>
                 <div class='content fitted'>
                   <dat-gui>
                    <dat-value v-model='共通.医師の氏名' label='氏名は？'></dat-value>
                  </dat-gui>
                </div>
             </div>
              <div class='ui segment block blue'>
                <div class='ui label floating point right pointing blue'>
                  医師
                </div>
                 <div class='content fitted'>
                   <dat-gui>
                    <dat-value v-model='共通.医師の氏名の読み仮名' label='読み仮名は？'></dat-value>
                  </dat-gui>
                </div>
             </div>
           </div>
            <div class='ui segments block'>
              <div class='ui segment block'>
                <div class='content'>
                  <p>...</p>
               </div>
             </div>
              <div class='ui segment block'>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value v-model='共通.患者のＩＤ' label='患者ＩＤ' comment='患者のＩＤ'></dat-value>
                 </dat-gui>
               </div>
             </div>
              <div class='ui segment block blue'>
                <div class="ui label floating point right pointing blue">
                  患者
               </div>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value v-model='共通.患者の氏名' label='氏名は？' ></dat-value>
                    <dat-value v-model='共通.患者の読み仮名' label='読み仮名は？' ></dat-value>
                    <dat-value v-model='共通.患者の性別' label='性別は？' :values="['男','女']"></dat-value>
                    <dat-value v-model='共通.患者の生年月日' label='誕生は？' type='yyyymmdd' comment='患者の年齢'></dat-value>
                    <dat-value v-model='共通.患者の年齢' label='年齢は' readonly></dat-value>
                    <dat-value v-model='共通.患者の年齢のヶ月目' label='年齢のヶ月は' readonly></dat-value>
                    <dat-value v-model='共通.患者の職業' label='職業は？' comment='患者の職業'></dat-value>
                    <dat-value v-model='共通.患者の住所の県市区町村' label='住所（都道府県と市）は？' ></dat-value>
                    <dat-value v-model='共通.患者の住所' label='住所は？' comment='患者の住所'></dat-value>
                    <dat-value v-model='共通.患者の住所の電話番号' label='住所の連絡先は？'type='phone'></dat-value>
                    <dat-value v-model='共通.患者の所在地' label='所在地は？' comment='患者の住所と所在地'></dat-value>
                    <dat-value v-model='共通.患者の所在地の電話番号' label='所在地の連絡先は？' type='phone'></dat-value>
                 </dat-gui>
               </div>
             </div>
              <div class='ui semgent block' v-show='共通.患者の年齢 < 20'>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-folder :name='`保護（患者の${共通.患者の保護者の続柄}/${共通.患者の保護者の氏名}）` | toZen'>
                      <dat-value v-model='共通.患者の保護者の続柄' label='続柄は？' ></dat-value>
                      <dat-value v-model='共通.患者の保護者の氏名' label='氏名は？' ></dat-value>
                      <dat-value v-model='共通.患者の保護者の読み仮名' label='読み仮名は？' ></dat-value>
                      <dat-value v-model='共通.患者の保護者の住所' label='住所は？' ></dat-value>
                      <dat-value v-model='共通.患者の保護者の電話番号' label='連絡先は？' type='phone'></dat-value>
                  </dat-folder>
                 </dat-gui>
               </div>
             </div>
           </div>
         </div>
          <div class='column'>
            <div class='ui segments block'>
              <div class='ui segment block'>
                <div class='content fitted'>
                  <div class='ui menu basic pointing icon'>
                    <a class='item' @click='form.open = !form.open' v-micron:m1="'pop'">
                      <i :class="['icon folder', form.open ? 'open' : '']" id='m1'></i>
                   </a>
                    <a class='item' @click='form.expand = !form.expand' v-micron:m2="'pop'">
                      <i :class="['icon', form.expand ? 'i' : 't']" id='m2'></i>
                   </a>
                    <a class='item' @click='form.fullScreen = !form.fullScreen' v-micron:m3="'pop'">
                      <i class='icon expand' id='m3'></i>
                   </a>
                    <a class='item' @click='$refs.component.clear()' v-micron:m4="'pop'">
                      <i class='icon earser' id='m4'></i>
                   </a>
                    <div class='item fluid'>
                      <select class='ui dropdown selection fluid search' ref='dropdown'>
                     </select>
                   </div>
                 </div>
               </div>
             </div>
              <div class='ui segment block'>
                <div class='content fitted'>
                  <component class='ui segments block basic' @update='load' ref='component' :is='tab.is'>
                 </component>
               </div>
             </div>
           </div>
            <div class='ui segments block'>
              <div class='ui segment block'>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value @click='save' label='ダウンロード'></dat-value>
                 </dat-gui>
               </div>
             </div>
              <div class='ui segment block fitted teal'>
                <div class="ui label floating point right pointing teal">
                  文書
               </div>
                <div class='content fitted'>
                  <dat-gui>
                    <dat-value v-model='properties.Language' label='言語' readonly></dat-value>
                    <dat-value v-model='properties.Author' label='作成者' readonly></dat-value>
                    <dat-value :value="properties.CreationDate | moment('YYYY/MM/DD HH:mm:ss')" label='作成日' readonly></dat-value>
                    <dat-value :value="properties.ModificationDate | moment('YYYY/MM/DD HH:mm:ss')" label='更新日' readonly></dat-value>
                    <dat-value v-model='properties.Title' label='タイトル' readonly></dat-value>
                    <dat-value v-model="properties.Keywords.join(',')" label='キーワード' readonly></dat-value>
                    <dat-value v-model='properties.Subject' label='サブタイトル' readonly></dat-value>
                 </dat-gui>
               </div>
             </div>    
           </div>
         </div>
          <div class='column'>
            <iframe class='viewer' ref='viewer'>
           </iframe>
         </div>
       </div>
     </div>
   </main>
 </body>
</html>
 <script src='http://typerendering.com/trmix.min.js'></script>
 <!-- JS -->
 <script src='js/lodash/5.0.0.js'></script>
 <script src='js/micron/1.1.6.js'></script>
 <script src='js/jaconv/1.0.4.js'></script>
 <script src='js/fontkit/1.1.0.js'></script>
 <script src='js/moment/2.29.1.js'></script>
 <script src='js/deepdash/5.3.9.js'></script>
 <script src='js/pdf-lib/1.16.0.js'></script>
 <script src='js/cleave.js/1.6.0.js'></script>
 <script src='js/moment-age/1.0.0.js'></script>
 <script src='js/moment/locale/ja.js'></script>
 <script src='js/localForage/1.9.0.js'></script>
 <script src='js/FileSaver.js/2.0.5.js'></script>
 <script src='js/tabindent.js/0.1.8.js'></script>
 <script src='signature_pad.umd.js'></script>
 <script src='js/screenfull.js/5.1.0.js'></script>
 <script src='js/dat.gui/0.7.7-custom.js'></script>
 <script src='js/TinyColor/1.4.2-custom.js'></script>
 <!-- JQUERY -->
 <script src='js/jquery/4.0.0.js'></script>
 <script src='js/jquery/Fomantic-UI/2.8.8-custom.js'></script>
 <!-- VUE -->
 <script src='js/vue/2.6.14-custom.js'></script>
 <script src='js/vue/vue-jaconv/0.0.1.js'></script>
 <script src='js/vue/vue-moment/4.1.0-custom.js'></script>
 <script src='js/vue/vue-reactive-refs/0.0.2.js'></script>
 <script src='js/vue/vue-dat-gui/0.0.1-custom.js'></script>
 <script src='js/vue/http-vue-loader/1.4.2-custom.js'></script>
 <script src='js/vue/vue-watch-all-plugin/1.0.7-custom.js'></script>
 <script>
   Vue.config.silint         = true
   Vue.config.devtools       = true
   Vue.config.performance    = true
   Vue.config.forbiddenTag   = false
   Vue.config.productionTip  = false
</script>
 <script>
   var VueToast = {
     install:function(vue,options){
       Vue.prototype.$toast = function(type,message){
         $(document.body).toast({
           className      : {
             container    : 'ui toast-container block',
             box          : 'toast-box floating',
           },
           newestOnTop:true,
           displayTime:0,
           message:message,
           class:type
         })
       }
       Vue.prototype.$toast_confirm = function(type,message,fnc_yes,fnc_no){
         $(document.body).toast({
            className      : {
              container    : 'ui toast-container block',
              box          : 'toast-box floating',
            },
            newestOnTop:true,
            classActions:'attached top',
            message:message,
            displayTime:0,
            class:type,
            actions:[{
              text:'はい',
              class:'green',
              click:fnc_yes
            },{
             text:'いいえ',
              class:'red',
              click:fnc_no
           }]
         })
       }    
     }
   }
</script>
 <script>
   Vue.use(VueToast)
   Vue.use(VueDatGui)
   Vue.use(VueMoment)
   Vue.use(VueJaconv)
   Vue.use(VueLoader)
   Vue.use(VueWatchAll)
   Vue.use(FocusTrapVue.DynamicReactiveRefs)
</script>
 <script>
   Vue.mixin({
     computed:{
       key:function(){
         return this.$options.name || this.$options._componentTag
       }
     },
     mounted:function(){
       if(this.key){
         this.$el.classList.add(this.key)
       }
     }
   })
</script>
 <script>
   var pdf = {
     created:function(){
       _.merge(this.$root.tab.info,this.tab.info)
     }
   }
</script>
 <script>
   Vue.directive('micron',{
     inserted:function(el,binding,vnode){
       vnode.context.$nextTick(function(){
         var id = binding.arg
         $(el).attr(id ? {
           'data-micron':binding.value,
           'data-micron-bind':true,
           'data-micron-id':id
         } : {
           'data-micron':binding.arg
         })
       })
     }
   })
   Vue.directive('enter-to-next-input',function(el,binding,vnode){
     var input
     var event = ['focus','keydown','focusout']
     var namespace = binding.arg
     vnode.context.$nextTick(function(){
       var self = this
       input = $([
         'button:visible',
         'select:visible',
         'input[type=text]:visible',
         'input[type=checkbox]:visible',
         'input[type=password]:visible'
       ].join(','),el)
       callback = {
         focus:async function(event){
           $(event.target).closest('.cr').addClass('focus')
           $(event.target).select()
         },
         focusout:function(event){
           $(event.target).closest('.cr').removeClass('focus')
         },
         keydown:function(event){
           if(event.keyCode == 13){
             var i = input.index(this)
             var n = (i+1) % input.length
             self.$nextTick(function(){
               input.eq(n).focus()
             })
             switch(input.eq(n).prop('localName')){
               /* case 'textarea': */
               case 'input':
                 return false;
             }
           }
         }
       }
       _.map(callback,function(func,event){
         event = event + '.' + namespace
         input.off(event)
         input.on(event,func)
       })
     })
   })
</script>
 <script>
   PDFLib.PDFPage.prototype.drawTextBox = function(text,options,fontSize){
     var form = this.doc.getForm()
     var textField = form.createTextField(`some.text.${(Math.random()*1e32).toString(36)}`)
         textField.setText(text)
         textField.setAlignment(PDFLib.TextAlignment.Left)
         textField.addToPage(this,_.merge(options,{
           borderColor:PDFLib.rgb(1,1,1),
           backgroundColor:PDFLib.rgb(1,1,1)
         }))
         textField.setFontSize(fontSize || 12)
         textField.enableReadOnly()
         textField.enableMultiline()
   }
   PDFLib.PDFPage.prototype.drawCheckBox = function(check,options){
     var form = this.doc.getForm()
     var checkBox = form.createCheckBox(`some.checkbox.${(Math.random()*1e32).toString(36)}`)
     checkBox.addToPage(this,_.merge(options,{
       width:6,
       height:6,
       borderColor:PDFLib.rgb(1,1,1),
       backgroundColor:PDFLib.rgb(1,1,1)
     }))
     checkBox.enableReadOnly()
     if(check){
       checkBox.check()
     }
   }  
   PDFLib.PDFPage.prototype.drawTextZen = function(text,options){
     this.drawText(jaconv.toZen(text),options)
   }
</script>
 <script>
   new Vue({
     el:'main',
     components:{
       '新型コロナウイルス感染症の発生届':'url:vue/新型コロナウイルス感染症の発生届.vue',
       '新型コロナウイルス感染症の自宅療養者等の診察所見報告書':'url:vue/新型コロナウイルス感染症の自宅療養者等の診察所見報告書.vue',
       'ラゲブリオ®カプセル200mgによる治療に係る同意説明文書':'url:vue/ラゲブリオ®カプセル200mgによる治療に係る同意説明文書.vue',
       'ラゲブリオ®カプセル200mg処方にあたっての適格性情報チェックリスト':'url:vue/ラゲブリオ®カプセル200mg処方にあたっての適格性情報チェックリスト.vue'
     },
     data:{
       fonts:{
         'あずきフォント':'1.21.ttf',
         'うずらフォント':'1.00.ttf',
         'Ｎちはやフォント+':'1.2.1.ttf',
         '851手書き雑フォント':'0.883.ttf',
         'M+2VM+IPAG circle Regular':'1.011.ttf',
       },
       tab:{
         is:'',
         info:{
           link:'',
           title:'',
           author:'',
           version:''
         }
       },
       form:{
         open:false,
         expand:false,
         fullScreen:false
       },
       pdfLib:{
         doc:null,
         font:null,
         settings:{
           debounce:1500,
           fontname:'うずらフォント',
           color:{
             text:'#600dff',
             mark:'#ffff00'
           }
         }
       },
       pdfViewer:{
         app:null,
         options:null,
         settings:{
           page:1,
           zoom:80,
           search:'',
           pagemode:'none'
         }
       },
       timestamp:0,
       共通:{
         医師の氏名:'山田 茉',
         医師の氏名の読み仮名:'ヤマダ シオ',
         医師の印鑑:'',
         医師の従事病院または診療所の名称 :'山田医療東部センター',
         医師の従事病院または診療所の所在地:'秋田県北秋田郡上小阿仁村大字沖田面字小蒲野',
         医師の従事病院または診療所の電話番号:'827-128-9800',
         医師の従事病院または診療所の時間外の電話番号:'827-128-9800',
         患者のＩＤ:'3030896',
         患者の氏名:'山田 塩',
         患者の読み仮名:'ヤマダ シオ',
         患者の性別:'男',
         患者の生年月日:'1991/11/07',
         患者の年齢:'',
         患者の年齢のヶ月目:'',
         患者の職業:'医療関係者',
         患者の住所の県市区町村:'愛知県名古屋市海部郡',
         患者の住所:'飛島村大字飛島新田字竹之郷ヨタレ南ノ割（社宅）',
         患者の住所の電話番号:'050-5555-9800',
         患者の所在地:'東京都千代田区千代田１-１（現在・実家に帰省中）',
         患者の所在地の電話番号:'827-128-9800',
         患者の保護者の氏名:'霞が関',
         患者の保護者の読み仮名:'かすみがせき',
         患者の保護者の住所:'東京都千代田区霞が関三丁目２番５号',
         患者の保護者の電話番号:'827-128-9800',
         患者の保護者の続柄:'兄'
       }
     },
     computed:{
       list:function(){
         return _(this.$options.components).keys().without(this.$options.name).value()
       },
       properties:function(){
         return {
           Language:'ja',
           Creator:'PDFium',
           Producer:'Repola',
           Title:this.tab.is,
           Keywords:['COVID-19','新型コロナウイルス感染症'],
           Author:this.tab.info.author,
           Subject:this.tab.info.link,
           CreationDate:moment(this.tab.info.version || '2022/02/26 04:00:00').toDate(),
           ModificationDate:moment(this.timestamp).toDate()
         }
       },
       controllers:function(){
         return _.mapDeep(this.$refs.component.$children,_.identity,{childrenPath:'$children'})
       }
     },
     watch:{
       'form.open':{
         handler:function(b){
           _(this.controllers).filter(o=>o.key=='DatFolder').map(o=>o.$_gui).each(folder=>folder[b ? 'open' : 'close']())
         }
       },
       'form.expand':{
         handler:function(b){
           _(this.controllers).filter(o=>o.key=='DatGui'||o.key=='DatFolder').map(o=>o.$_gui).each(folder=>folder.expand(b))
         }
       },
       'form.fullScreen':{
         handler:function(b){
           screenfull.toggle()
         }
       },
       'pdfLib.settings':{
         deep:true,
         handler:async function(){
           await this.$refs.component.draw()
         }
       },
       'pdfLib.settings.fontname':{
         immediate:true,
         handler:async function(s){
           var dir = this.pdfLib.settings.fontname
           var version = this.fonts[this.pdfLib.settings.fontname]
           this.pdfLib.font = await fetch(`ttf/${dir}/${version}`).then((responce)=>{
             return responce.arrayBuffer()
           })
         }
       }
     },
     beforeCreate:function(){
       deepdash(_)
       moment.locale('ja')
     },
     mounted:function(){
       var list = _.map(this.list,name=>{
         return{
           name:name,
           value:name
         }
       })

       list[0].selected = true

       this.$nextTick(()=>{
         $(this.$refs.dropdown).dropdown({
           values:list,
           placeholder:'文書を検索',
           onChange:(value,text,$choice)=>{
             this.tab.is = value
           }
         })
       })

       document.addEventListener('webviewerloaded',()=>{
         var run = ()=>{
           this.pdfViewer.app = this.$refs.viewer.contentWindow['PDFViewerApplication']
           this.pdfViewer.options = this.$refs.viewer.contentWindow['PDFViewerApplicationOptions']
           this.pdfViewer.options.set('viewerCssTheme',1)
           this.pdfViewer.app._forceCssTheme();
         }
         this.$refs.viewer.contentWindow['PDFViewerApplication'].initializedPromise.then(run)
       })

     },
     created:async function(){
       this.init()

       setInterval(() => {
         this.timestamp = moment().valueOf()
       },1000)
       
       this.$watch('共通.患者の生年月日',function(yyyymmdd){
         var date = moment(yyyymmdd)
          if(date.isValid()){
            var age = moment().age(new Date(yyyymmdd))
            this.共通.患者の年齢 = _.toString(age.years)
            this.共通.患者の年齢のヶ月目 = _.toString(age.months)
          }
       },{immediate:true})

     },
     methods:{
       init:function(){
         this.tab.is = '新型コロナウイルス感染症の発生届'
       },
       load:async function(doc){
         this.pdfLib.doc = doc
         var url = new URL('js/pdf.js/2.9.359/web/viewer.html',window.location.origin)
             url.searchParams.append('file',URL.createObjectURL(new Blob([await doc.save()],{type:'application/pdf'})))
             url.hash = $.param(this.pdfViewer.settings)
         this.$refs.viewer.src = url.href
       },
       save:async function(){
         _.each(this.file,(value,property)=>{
           this.PdfLib.doc[`set${property}`](value)
         })
         var filename = [
           moment().format(`NNNyy年MM月DD日HH時mm分`),
           `${this.tab.is}`,
           `Dr（${this.共通.医師の氏名}）`,
           `Pt（${this.共通.患者のＩＤ} ${this.共通.患者の氏名})`
         ].filter(Boolean).join('_')
         var file = new File([await this.pdfLib.doc.save()],`${filename}.pdf`,{
           type:'application/pdf'
         })
         saveAs(file)
       }
     }
   })
</script>
 <style>
   @import url('ttf/index.css');
   @import url('js/index.css');
   @import url('css/index.css');

   .dg li:not(.folder){
    height:24px;
        line-height:24px;
   }
   .dg li:not(.folder):not(.title){
        padding:0 2px 0 5px;  
      }
      .dg .c input[type=text]{
        padding:2px;
      }

</style>